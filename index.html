、<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>方案C - 前端静态页</title>
  <style>
    body{font-family:system-ui,Segoe UI,Arial;max-width:900px;margin:24px auto;padding:0 12px;line-height:1.4}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    input,button,textarea{padding:10px;border:1px solid #ccc;border-radius:8px;font-size:14px}
    input{flex:1;min-width:240px}
    button{cursor:pointer}
    textarea{width:100%;min-height:180px}
    .card{border:1px solid #eee;border-radius:12px;padding:12px;margin:12px 0}
    .hint{color:#666;font-size:13px}
    .ok{color:#0a7}
    .bad{color:#c00}
    code{background:#f6f6f6;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <h2>方案C 前端静态页</h2>
  <div class="card">
    <div class="row">
      <input id="base" placeholder="填你的后端地址，例如：http://47.123.7.54:8081" />
      <button onclick="saveBase()">保存</button>
      <button onclick="openAdmin()">打开 /admin</button>
      <button onclick="openStatic()">打开 /static/simple.html</button>
    </div>
    <div class="hint">
      说明：这个页面是<strong>纯静态</strong>，只能负责“发请求/跳转”。后端必须能公网访问时才会成功。
      <br/>如果你后端在国内网络/轻量服务器上被拦，打开会 <span class="bad">502/超时</span>，这不是前端问题。
    </div>
  </div>

  <div class="card">
    <h3>测试接口：POST <code>/api/manual</code></h3>
    <div class="row">
      <button onclick="callManual()">发送请求</button>
      <button onclick="fillDemo()">填入示例 JSON</button>
    </div>
    <textarea id="payload" placeholder='这里填要发给 /api/manual 的 JSON，比如：{"a":1}'></textarea>
    <div class="row">
      <div id="status" class="hint"></div>
    </div>
    <textarea id="output" placeholder="这里显示返回结果"></textarea>
  </div>

<script>
  const baseEl = document.getElementById("base");
  const payloadEl = document.getElementById("payload");
  const outEl = document.getElementById("output");
  const statusEl = document.getElementById("status");

  function normBase(s){
    s = (s||"").trim();
    if(!s) return "";
    s = s.replace(/\/+$/,"");
    return s;
  }

  function saveBase(){
    const v = normBase(baseEl.value);
    localStorage.setItem("SCHEME_C_BASE", v);
    statusEl.innerHTML = v ? `已保存后端地址：<span class="ok">${v}</span>` : `<span class="bad">后端地址为空</span>`;
  }

  function loadBase(){
    const v = localStorage.getItem("SCHEME_C_BASE") || "";
    baseEl.value = v;
  }

  function openAdmin(){
    const b = normBase(baseEl.value);
    if(!b) return alert("先填后端地址（例如 http://47.123.7.54:8081）");
    window.open(b + "/admin", "_blank");
  }

  function openStatic(){
    const b = normBase(baseEl.value);
    if(!b) return alert("先填后端地址（例如 http://47.123.7.54:8081）");
    window.open(b + "/static/simple.html", "_blank");
  }

  function fillDemo(){
    payloadEl.value = JSON.stringify({ action:"manual", ts: Date.now() }, null, 2);
  }

  async function callManual(){
    const b = normBase(baseEl.value);
    if(!b) return alert("先填后端地址（例如 http://47.123.7.54:8081）");

    let bodyObj;
    try{
      bodyObj = payloadEl.value ? JSON.parse(payloadEl.value) : {};
    }catch(e){
      return alert("JSON 格式不对：\n" + e.message);
    }

    statusEl.textContent = "请求中...";
    outEl.value = "";

    try{
      const resp = await fetch(b + "/api/manual", {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(bodyObj)
      });

      const text = await resp.text();
      statusEl.innerHTML = `HTTP 状态：<strong>${resp.status}</strong> ${resp.ok ? '<span class="ok">(OK)</span>' : '<span class="bad">(FAIL)</span>'}`;
      outEl.value = text;
    }catch(err){
      statusEl.innerHTML = `<span class="bad">请求失败（通常是跨域/CORS 或后端公网不可达）：</span>${err}`;
    }
  }

  loadBase();
</script>
</body>
</html>
